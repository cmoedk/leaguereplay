(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){module.exports={id:{fixtures:"fixtures",container:"container",structure:"structure",centerDiv:"centerdiv",stats:"stats"},"class":{},type:{league:"league"}}},{}],2:[function(require,module,exports){module.exports=ReplayEngine;function ReplayEngine(databaseUrl){var _this=this;this.databaseUrl=databaseUrl;this.matchCounter=-1;this.goalscorers={};this.eventCounter=-1;this.events=[];this.match={};this.$match={};this.lastHighlight="";this.videoIsPlaying=false;this.paused=false;this.resumeEvent=null;this.teamFollowing="All Teams";this.sortOrder=[[8,1],[7,1],[5,1],[0,0]];this.fixtures=$("#fixtures");this.fixtureTable=this.fixtures.find("table");this.structure=$("#structure");this.leagueTable=this.structure.find("table");this.leagueTableBody=this.structure.find("tbody");this.section=this.structure.find("section");this.topscorers=$("#topscorers");this.topscorersBody=this.topscorers.find("table").find("tbody");this.topscorerTable=$("#topscorertable");$.ajax({type:"GET",url:this.databaseUrl,dataType:"text",async:true,error:function(jqXHR,textStatus,errorThrown){console.log("Issue: "+textStatus+" "+errorThrown+" !")},success:function(data){_this.data=$.parseJSON(data);_this.init()}})}ReplayEngine.prototype.init=function(){var _this=this;var matchRequest=window.location.hash.substr(1);for(var i=0,len=this.data.length;i<len;i++){var match=this.data[i];drawFixture(match);addTeamsToLeagueTable(match);addTeamsToDropdownMenu(match)}if(matchRequest!==""){var matchId=parseInt(matchRequest);for(i=0,len=this.data.length;i<len;i++){match=this.data[i];if(match.dbid!==matchId){this.match=match;this.updateTable(match,true);this.matchCounter++}else{break}}}this.sortLeagueTable();$("#selectTeamDropdown").html($("#selectTeamDropdown option").sort(function(a,b){return a.text==b.text?0:a.text<b.text?-1:1}));$("#selectTeamDropdown").prepend("<option selected>All Teams</option>");$("#selectTeamDropdown").change(function(){_this.teamFollowing=$(this).find("option:selected").text()});$("#start").one("click",function(){_this.start();$(this).html("Pause");$(this).addClass("playing");$(this).on("click",function(){if($(this).html()==="Pause"){if(_this.pause()){$(this).html("Resume");$(this).removeClass("playing")}}else{if(_this.resume()){$(this).html("Pause");$(this).addClass("playing")}}})});function drawFixture(match){var date=_this.formatDate(match.start);var fixture=$('<tr id="'+match.dbid+'" title="'+match.dbid+'"></tr>');if(_this.fixtureTable.find("#"+date.id).length===0){_this.fixtureTable.append('<tr><td id="'+date.id+'" class="date" colspan = 3>'+date.text+"</td></tr>")}fixture.append('<td class="hometeam">'+match.homeTeam.name+'<p class="homescorers"></p></td>','<td><span class="homegoals">&nbsp;</span> - <span class="awaygoals">&nbsp;</span></td>','<td class="awayteam">'+match.awayTeam.name+'<p class="awayscorers"></p></td>');_this.fixtureTable.append(fixture)}function addTeamsToLeagueTable(match){var homeTeamId=match.homeTeam.dbid;var awayTeamId=match.awayTeam.dbid;if(_this.leagueTableBody.find("#"+homeTeamId).length===0){_this.leagueTableBody.append('<tr id="'+homeTeamId+'"><td>'+match.homeTeam.name+'</td><td class="gp">0</td><td class="w">0</td><td class="d">0</td>'+'<td class="l">0</td><td class="gf">0</td><td class="ga">0</td><td class="gd">0</td><td class="pts">0</td></tr>')}if(_this.leagueTableBody.find("#"+awayTeamId).length===0){_this.leagueTableBody.append('<tr id="'+awayTeamId+'"><td>'+match.awayTeam.name+'</td><td class="gp">0</td><td class="w">0</td><td class="d">0</td>'+'<td class="l">0</td><td class="gf">0</td><td class="ga">0</td><td class="gd">0</td><td class="pts">0</td></tr>')}}function addTeamsToDropdownMenu(match){var homeTeamId=match.homeTeam.dbid;var awayTeamId=match.awayTeam.dbid;var dropdownList=document.getElementById("selectTeamDropdown").options;var homeTeamExists=false;var awayTeamExists=false;console.log("IN");for(var j=0;j<dropdownList.length;j++){if(dropdownList[j].value==match.homeTeam.dbid){homeTeamExists=true;break}}for(var j=0;j<dropdownList.length;j++){if(dropdownList[j].value==match.awayTeam.dbid){awayTeamExists=true;break}}if(!homeTeamExists){$("#selectTeamDropdown").append('<option value="'+homeTeamId+'">'+match.homeTeam.name+"</option>")}if(!awayTeamExists){$("#selectTeamDropdown").append('<option value="'+awayTeamId+'">'+match.awayTeam.name+"</option>")}}};ReplayEngine.prototype.sortLeagueTable=function(){var _this=this;this.leagueTable.remove().appendTo(this.section).tablesorter({sortList:_this.sortOrder})};ReplayEngine.prototype.sortTopScorers=function(){this.topscorerTable.remove().appendTo(this.topscorers).tablesorter({sortList:[[1,1],[0,0]]})};ReplayEngine.prototype.formatDate=function(timestamp){var monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"];var date=new Date(timestamp);var day=date.getDate();var monthIndex=date.getMonth();var year=date.getFullYear();var text=day+" "+monthNames[monthIndex]+" "+year;var id=day+monthNames[monthIndex]+year;return{text:text,id:id}};ReplayEngine.prototype.start=function(){this.processMatch(this.data[++this.matchCounter]);this.nextEvent()};ReplayEngine.prototype.pause=function(){if(this.videoIsPlaying){$("video")[0].pause();return true}else{return false}};ReplayEngine.prototype.resume=function(){if(this.videoIsPlaying){$("video")[0].play();return true}else{return false}};ReplayEngine.prototype.addEvent=function(event){this.events.push(event)};ReplayEngine.prototype.highlightMatch=function(){var $hometeam=$("#"+this.match.homeTeam.dbid);var $awayteam=$("#"+this.match.awayTeam.dbid);this.$match.addClass("highlight");$hometeam.addClass("highlight");$awayteam.addClass("highlight");var date=this.formatDate(this.match.start);var $dateHeader=$("#"+date.id);var offset_t=$dateHeader.position().top+this.fixtures.scrollTop()-$("#header").height();this.fixtures.animate({scrollTop:offset_t},2e3);this.nextEvent()};ReplayEngine.prototype.endMatch=function(){var $hometeam=$("#"+this.match.homeTeam.dbid);var $awayteam=$("#"+this.match.awayTeam.dbid);this.$match.removeClass("highlight");$hometeam.removeClass("highlight");$awayteam.removeClass("highlight");if(this.match.awayGoals+this.match.homeGoals===0){this.updateTable(this.match)}this.nextEvent()};ReplayEngine.prototype.initScore=function(){var $homegoals=this.$match.find(".homegoals");var $awaygoals=this.$match.find(".awaygoals");$homegoals.html(0);$awaygoals.html(0);this.nextEvent()};ReplayEngine.prototype.addScorer=function(player){if(!this.goalscorers[player.dbid]){this.goalscorers[player.dbid]=player;this.goalscorers[player.dbid].totalGoals=1;this.topscorersBody.append('<tr id="'+player.dbid+'"><td>'+player.name+'</td><td class="total">'+this.goalscorers[player.dbid].totalGoals+"</td></tr>")}else{this.goalscorers[player.dbid].totalGoals++;var prow=$("#"+player.dbid);prow.find(".total").html(this.goalscorers[player.dbid].totalGoals)}var playerRow=prow?prow:$("#"+player.dbid);this.sortTopScorers();playerRow.addClass("highlight");setTimeout(function(){playerRow.removeClass("highlight")},3e3)};ReplayEngine.prototype.updateTable=function(event,noEvent){var $hometeam=$("#"+this.match.homeTeam.dbid);var $awayteam=$("#"+this.match.awayTeam.dbid);if(event.homeGoals+event.awayGoals===1){this.match._oldstats={home:$hometeam.clone(),away:$awayteam.clone()}}if(!noEvent&&event.homeGoals+event.awayGoals!==0){$hometeam.html(this.match._oldstats.home.html());$awayteam.html(this.match._oldstats.away.html())}s("gp");if(event.homeGoals>event.awayGoals){s("pts",$hometeam,3);s("w",$hometeam);s("l",$awayteam)}else if(event.homeGoals<event.awayGoals){s("pts",$awayteam,3);s("w",$awayteam);s("l",$hometeam)}else{s("pts");s("d",$hometeam);s("d",$awayteam)}s("gf",$hometeam,event.homeGoals);s("ga",$hometeam,event.awayGoals);s("gf",$awayteam,event.awayGoals);s("ga",$awayteam,event.homeGoals);var homegd=parseInt($hometeam.find(".gf").html())-parseInt($hometeam.find(".ga").html());var awaygd=parseInt($awayteam.find(".gf").html())-parseInt($awayteam.find(".ga").html());$hometeam.find(".gd").html(homegd);$awayteam.find(".gd").html(awaygd);this.sortLeagueTable();function s(ele,team,val){var teams=team?[team]:[$hometeam,$awayteam];val=typeof val!=="undefined"?val:1;for(var i=0;i<teams.length;i++){var value=parseInt(teams[i].find("."+ele).html());teams[i].find("."+ele).html(value+val)}}};ReplayEngine.prototype.goal=function(event){var _this=this;return function(){var $homegoals=_this.$match.find(".homegoals");var $awaygoals=_this.$match.find(".awaygoals");$homegoals.html(event.homeGoals);$awaygoals.html(event.awayGoals);if(event.scoringSide==="H"){_this.$match.find(".homescorers").append(event.scoringPlayer.name+" ("+event.matchTimeString+(event.ownGoal?" og":"")+")<br />")}else{_this.$match.find(".awayscorers").append(event.scoringPlayer.name+" ("+event.matchTimeString+(event.ownGoal?" og":"")+")<br />")}if(!event.ownGoal){_this.addScorer(event.scoringPlayer)}_this.updateTable(event);var index=0;var highlight=event.highlights[index];while(highlight===_this.lastHighlight){index++;if(!event.highlights[index]){break}highlight=event.highlights[index]}_this.lastHighlight=highlight;if(event.highlights.length>0){$("video").one("ended",function(){$(this).off("error");$(this).prop("src","");_this.videoIsPlaying=false;_this.nextEvent()}).off("error").one("error",function(){console.log("error loading "+$(this).prop("src")+". Trying fat.");highlight=$(this).prop("src").replace("giant.","fat.");$("video").off("error").one("error",function(){console.log("error loading "+highlight);_this.videoIsPlaying=false;_this.nextEvent()}).prop("src",highlight)[0].play();_this.videoIsPlaying=true}).prop("src",highlight)[0].play();_this.videoIsPlaying=true}else{_this.nextEvent()}}};ReplayEngine.prototype.processMatch=function(match){this.match=match;this.$match=$("#"+this.match.dbid);if(this.teamFollowing!="All Teams"&&match.homeTeam.name!=this.teamFollowing&&match.awayTeam.name!=this.teamFollowing){this.updateTable(match,true);return}this.addEvent(this.highlightMatch);this.addEvent(this.initScore);var goalNum=0;var matchEvents=this.match.matchevents;matchEvents.sort(function(a,b){if(a.happenedAt<b.happenedAt){return-1}if(a.happenedAt>b.happenedAt){return 1}return 0});for(var i=0;i<matchEvents.length;i++){var event=matchEvents[i];if(event.type==="goal"){this.addEvent(this.goal(event,goalNum));goalNum++}}this.addEvent(this.endMatch)};ReplayEngine.prototype.nextEvent=function(){this.eventCounter++;var _this=this;if(this.events[this.eventCounter]){var fn=_this.events[_this.eventCounter];if(this.eventCounter===0){$.proxy(fn,_this)()}else{setTimeout($.proxy(fn,_this),2e3)}}else{this.events=[];this.eventCounter=-1;this.matchCounter++;if(this.data[this.matchCounter]){this.processMatch(this.data[this.matchCounter]);this.nextEvent()}else{console.log("No more events")}}}},{}],3:[function(require,module,exports){var config=require("./config.js");var ReplayEngine=require("./core/ReplayEngine.js");var LeagueView=require("./views/LeagueView.js");var FixtureView=require("./views/FixtureView.js");var VideoView=require("./views/VideoView.js");var TableView=require("./views/TableView.js");$(document).on("ready",function(){new LeagueView({title:"Premier League 2015/2016",id:"leagueTable"});new FixtureView({title:"Fixtures"});var topscorers=new TableView({id:"topScorers",title:"Top Scorers",parent:config.id.stats});topscorers.addHeader({tr:[{th:"Name"},{th:"Goals"}]});topscorers.render();var replay=new ReplayEngine("./matches.json")})},{"./config.js":1,"./core/ReplayEngine.js":2,"./views/FixtureView.js":4,"./views/LeagueView.js":5,"./views/TableView.js":6,"./views/VideoView.js":7}],4:[function(require,module,exports){module.exports=FixtureView;var TableView=require("./TableView.js");var config=require("../config.js");function FixtureView(options){TableView.call(this,options);this.parent=config.id.fixtures;this.render()}FixtureView.prototype=Object.create(TableView.prototype)},{"../config.js":1,"./TableView.js":6}],5:[function(require,module,exports){module.exports=LeagueView;var config=require("../config.js");var TableView=require("./TableView.js");function LeagueView(options){TableView.call(this,options);this.parent=config.id.structure;this.addHeader({tr:[{th:"Club"},{th:"GP"},{th:"W"},{th:"D"},{th:"L"},{th:"GF"},{th:"GA"},{th:"GD"},{th:"PTS"}]});this.render()}LeagueView.prototype=Object.create(TableView.prototype)},{"../config.js":1,"./TableView.js":6}],6:[function(require,module,exports){module.exports=TableView;function TableView(options){this.id=options.id||"";this.title=options.title||"";this.parent=options.parent||"";this.html={};if(this.title){this.html['h1[class="title"]']=this.title}this.html.table={thead:[],tbody:[]}}TableView.prototype.addHeader=function addHeader(trow){this.html.table["thead"].push(trow)};TableView.prototype.render=function(){var absurd=Absurd();var _this=this;var setup={};if(this.id){var sectionTag='section[id="'+this.id+'"]';setup.html={};setup.html[sectionTag]=this.html}else{setup.html=this.html}setup.constructor=function(){this.populate();$("#"+_this.parent).append(this.el)};absurd.component("TableView",setup)()}},{}],7:[function(require,module,exports){},{}]},{},[3]);
