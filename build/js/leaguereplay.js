(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){module.exports={id:{FIXTURES:"fixtures",CONTAINER:"container",STRUCTURE:"structure",CENTER_DIV:"centerdiv",STATS:"stats"},"class":{DATE:"date",FOLLOWED:"followed",FOLLOW_TEAM:"follow-team",MATCH_SELECT:"match-select",MATCH_SELECTED:"match-selected"},type:{LEAGUE:"league"},FINISH:"finished",LEAGUE_SORTORDER:[[8,1],[7,1],[5,1],[0,0]],TOPSCORERS:"topscorers",FIXTURES:"fixtures"}},{}],2:[function(require,module,exports){module.exports=Competition;require("../mixins/jQuery.EventEmitter.js");var Round=require("./Round.js");var config=require("../config.js");function Competition(compId){var _this=this;this.rounds=[];this.currentRound=0;this.databaseUrl="./matches.json";this.data={};$.ajax({type:"GET",url:this.databaseUrl,dataType:"text",async:true,error:function(jqXHR,textStatus,errorThrown){console.log("Issue: "+textStatus+" "+errorThrown+" !")},success:function(data){_this.data=$.parseJSON(data);for(var i=0;i<_this.data.length;i++){_this.rounds.push(new Round(_this.data[i]))}_this.emit("ready")}})}jQuery.extend(Competition.prototype,jQuery.eventEmitter);Competition.prototype.render=function(){for(var i=0;i<this.rounds.length;i++){this.rounds[i].render()}};Competition.prototype.nextMatch=function(){var nextMatch=this.rounds[this.currentRound].nextMatch();if(nextMatch){return nextMatch}else{this.currentRound++;if(!this.rounds[this.currentRound]){return false}else{return this.rounds[this.currentRound].nextMatch()}}};Competition.prototype.update=function(event,followMatch){this.rounds[this.currentRound].update(event,followMatch)};Competition.prototype.addScorer=function(player){this.rounds[this.currentRound].addScorer(player)}},{"../config.js":1,"../mixins/jQuery.EventEmitter.js":7,"./Round.js":5}],3:[function(require,module,exports){module.exports=Match;var config=require("../config.js");var util=require("../util.js");function Match(matchData){this.data=matchData;this.data.matchevents.sort(function(a,b){if(a.happenedAt<b.happenedAt){return-1}if(a.happenedAt>b.happenedAt){return 1}return 0})}Match.prototype.getGoals=function(){var goals=[];for(var i=0;i<this.data.matchevents.length;i++){if(this.data.matchevents[i].type==="goal"){goals.push(this.data.matchevents[i])}}return goals}},{"../config.js":1,"../util.js":9}],4:[function(require,module,exports){module.exports=ReplayEngine;var config=require("../config.js");var settings=require("../settings.js");var util=require("../util.js");var Competition=require("./Competition.js");function ReplayEngine(compId){var _this=this;this.competition=new Competition(compId);this.events=[];this.eventCounter=-1;this.simulateTo=-1;this.currentMatch=null;this.$currentMatch=null;this.videoIsPlaying=false;this.$fixtures=$("#fixtures");this.competition.on("ready",function(){_this.competition.render()});$(document).on("click","."+config.class.FOLLOW_TEAM,function(e){e.preventDefault();if($(this).hasClass(config.class.FOLLOWED)){_this.removeFollow($(this).attr("data-id"))}else{_this.addFollow($(this).attr("data-id"))}});$(document).one("click","."+config.class.MATCH_SELECT,function(e){e.preventDefault();selectMatch(this);$("#start").trigger("click");$(document).on("click","."+config.class.MATCH_SELECT,function(e){e.preventDefault();selectMatch(this)});function selectMatch(el){if($(el).hasClass(config.class.MATCH_SELECTED)){$(el).removeClass(config.class.MATCH_SELECTED);_this.simulateTo=-1;return}$("."+config.class.MATCH_SELECTED).removeClass(config.class.MATCH_SELECTED);_this.simulateTo=$(el).parent().attr("id");$(el).addClass(config.class.MATCH_SELECTED)}});$("#start").one("click",function(){$(this).html("Pause");$(this).addClass("playing");$(this).on("click",function(){if($(this).html()==="Pause"){if(_this.pause()){$(this).html("Resume");$(this).removeClass("playing")}}else{if(_this.resume()){$(this).html("Pause");$(this).addClass("playing")}}});_this.processMatch(_this.competition.nextMatch());_this.nextEvent()})}ReplayEngine.prototype.removeFollow=function(teamId){$("."+util.teamClass(teamId)).removeClass(config.class.FOLLOWED);util.removeVal(settings.FOLLOW_TEAMS,parseInt(teamId))};ReplayEngine.prototype.addFollow=function(teamId){$("."+util.teamClass(teamId)).addClass(config.class.FOLLOWED);settings.FOLLOW_TEAMS.push(parseInt(teamId))};ReplayEngine.prototype.willFollow=function(match){return this.simulateTo===-1&&(util.findOne([match.data.homeTeam.dbid,match.data.awayTeam.dbid],settings.FOLLOW_TEAMS)||settings.FOLLOW_TEAMS.length===0)};ReplayEngine.prototype.processMatch=function(match){this.currentMatch=match;this.$currentMatch=$("#"+util.matchId(this.currentMatch.data.dbid));if(util.matchId(this.currentMatch.data.dbid)===this.simulateTo){this.simulateTo=-1}var followMatch=this.willFollow(this.currentMatch);if(followMatch){$("."+config.class.MATCH_SELECTED).removeClass(config.class.MATCH_SELECTED);this.addEvent(this.highlightMatch,followMatch)}var goals=match.getGoals();for(var i=0;i<goals.length;i++){this.addEvent(this.goal(goals[i],followMatch),followMatch)}this.addEvent(this.endMatch,followMatch)};ReplayEngine.prototype.highlightMatch=function(){var $hometeam=$("#"+this.currentMatch.data.homeTeam.dbid);var $awayteam=$("#"+this.currentMatch.data.awayTeam.dbid);var $homegoals=this.$currentMatch.find(".homegoals");var $awaygoals=this.$currentMatch.find(".awaygoals");this.$currentMatch.addClass("highlight");$hometeam.addClass("highlight");$awayteam.addClass("highlight");$homegoals.html(0);$awaygoals.html(0);var date=util.formatDate(this.currentMatch.data.start);var $dateHeader=$("#"+date.id);var offset_t=$dateHeader.position().top+this.$fixtures.scrollTop()-$("#header").height();this.$fixtures.animate({scrollTop:offset_t},settings.SCROLL_TO_MATCH_DURATION);this.nextEvent()};ReplayEngine.prototype.goal=function(event,followMatch){var _this=this;var $match=this.$currentMatch;var rendered=false;return function(){var $homegoals=$match.find(".homegoals");var $awaygoals=$match.find(".awaygoals");if(followMatch){var index=0;var highlight=event.highlights[index];while(highlight===_this.lastHighlight){index++;if(!event.highlights[index]){break}highlight=event.highlights[index]}highlight.replace("giant","zippy");_this.lastHighlight=highlight;if(event.highlights.length>0){$("video").one("ended",function(){render();$(this).off("error");$(this).prop("src","");_this.videoIsPlaying=false;_this.nextEvent()}).off("error").one("error",function(){console.log("error loading "+$(this).prop("src")+". Trying fat.");highlight=$(this).prop("src").replace("zippy.","fat.");$("video").off("error").one("error",function(){console.log("error loading "+highlight);render();_this.videoIsPlaying=false;_this.nextEvent()}).prop("src",highlight)[0].play();_this.videoIsPlaying=true}).on("timeupdate",function(){if(!rendered&&this.currentTime/this.duration>.5){render();rendered=true}}).prop("src",highlight)[0].play();_this.videoIsPlaying=true}else{render();_this.nextEvent()}}else{render();_this.nextEvent()}function render(){if(rendered){return}$homegoals.html(event.homeGoals);$awaygoals.html(event.awayGoals);if(event.scoringSide==="H"){$match.find(".homescorers").append(event.scoringPlayer.name+" ("+event.matchTimeString+(event.ownGoal?" og":"")+")<br />")}else{$match.find(".awayscorers").append(event.scoringPlayer.name+" ("+event.matchTimeString+(event.ownGoal?" og":"")+")<br />")}if(!event.ownGoal){_this.competition.addScorer(event.scoringPlayer)}_this.competition.update(event,followMatch)}}};ReplayEngine.prototype.endMatch=function(){var $hometeam=$("#"+this.currentMatch.data.homeTeam.dbid);var $awayteam=$("#"+this.currentMatch.data.awayTeam.dbid);this.$currentMatch.removeClass("highlight");$hometeam.removeClass("highlight");$awayteam.removeClass("highlight");if(this.currentMatch.data.awayGoals+this.currentMatch.data.homeGoals===0){this.competition.update(this.currentMatch,this.willFollow(this.currentMatch))}this.nextEvent()};ReplayEngine.prototype.pause=function(){if(this.videoIsPlaying){$("video")[0].pause();return true}else{return false}};ReplayEngine.prototype.resume=function(){if(this.videoIsPlaying){$("video")[0].play();return true}else{return false}};ReplayEngine.prototype.addEvent=function(event,followMatch){this.events.push({fn:event,delay:followMatch?settings.EVENT_DELAY:0})};ReplayEngine.prototype.nextEvent=function(){this.eventCounter++;var _this=this;if(this.events[this.eventCounter]){var fn=_this.events[_this.eventCounter].fn;var delay=_this.events[_this.eventCounter].delay;if(this.eventCounter===0){$.proxy(fn,_this)()}else{setTimeout($.proxy(fn,_this),delay)}}else{this.events=[];this.eventCounter=-1;var nextMatch=_this.competition.nextMatch();if(nextMatch){_this.processMatch(nextMatch);_this.nextEvent()}else{console.log("No more events")}}}},{"../config.js":1,"../settings.js":8,"../util.js":9,"./Competition.js":2}],5:[function(require,module,exports){module.exports=Round;var config=require("../config.js");var settings=require("../settings.js");var util=require("../util.js");var View=require("../views/View.js");var LeagueView=require("../views/LeagueView.js");var FixtureView=require("../views/FixtureView.js");var VideoView=require("../views/VideoView.js");var TableView=require("../views/TableView.js");var Match=require("./Match.js");function Round(roundData){this.data=roundData;this.matches=[];this.currentMatch=-1;this.addedTeams=[];this.addedDates=[];this.goalscorers={};this.oldStats={home:null,away:null};this.structureId=this.data.type+this.data.dbid;this.$fixtures=$("#"+config.id.FIXTURES);this.$structure=$("#"+config.id.STRUCTURE);this.data.fixtures.sort(function(a,b){if(a.start<b.start){return-1}if(a.start>b.start){return 1}return 0});for(var i=0;i<this.data.fixtures.length;i++){this.matches.push(new Match(this.data.fixtures[i]))}}Round.prototype.render=function(){var view=null;var fixtures="";var structure="";switch(this.data.type){case config.type.LEAGUE:view=new View([new LeagueView({title:this.data.title,id:this.structureId}),new FixtureView({title:"Fixtures",id:this.structureId+config.FIXTURES}),new TableView({id:"topScorers",title:"Top Scorers",parent:config.id.STATS,header:{tr:[{th:"Name"},{th:"Goals"}]}})]);for(var i=0,len=this.data.fixtures.length;i<len;i++){var match=this.data.fixtures[i];fixtures+=this.fixtureHTML(match);structure+=this.leagueHTML(match)}}if(view!==null){view.render();this.$fixtures.find("tbody").append(fixtures);this.$structure.find("#"+this.structureId).find("tbody").append(structure);util.sortTable($("#"+this.structureId).find("table"),config.LEAGUE_SORTORDER)}else{console.log("Error: no views")}};Round.prototype.fixtureHTML=function(match){var fixture="";var date=util.formatDate(match.start);if($.inArray(date.id,this.addedDates)===-1){fixture+='<tr><td id="'+date.id+'" class="'+config.class.DATE+'" colspan = 3>'+date.text+"</td></tr>";this.addedDates.push(date.id)}fixture+='<tr id="'+util.matchId(match.dbid)+'">'+'<td class="hometeam">'+'<a href="#" class="'+config.class.FOLLOW_TEAM+" "+util.teamClass(match.homeTeam.dbid)+'" data-id="'+match.homeTeam.dbid+'"> '+match.homeTeam.name+'</a><p class="homescorers"></p></td>'+'<td class="'+config.class.MATCH_SELECT+'"><span class="homegoals">&nbsp;</span> - <span class="awaygoals">&nbsp;</span></td>'+'<td class="awayteam">'+'<a href="#" class="'+config.class.FOLLOW_TEAM+" "+util.teamClass(match.awayTeam.dbid)+'" data-id="'+match.homeTeam.dbid+'"> '+match.awayTeam.name+'<p class="awayscorers"></p></td></tr>';return fixture};Round.prototype.leagueHTML=function(match){var row="";if($.inArray(match.homeTeam.dbid,this.addedTeams)===-1){row+=tableRow(match.homeTeam);this.addedTeams.push(match.homeTeam.dbid)}if($.inArray(match.awayTeam.dbid,this.addedTeams)===-1){row+=tableRow(match.awayTeam);this.addedTeams.push(match.awayTeam.dbid)}return row;function tableRow(team){return'<tr id="'+team.dbid+'"><td>'+'<a href="#" class="'+config.class.FOLLOW_TEAM+" "+util.teamClass(team.dbid)+'" data-id="'+team.dbid+'"> '+team.name+"</a>"+'</td><td class="gp">0</td><td class="w">0</td><td class="d">0</td>'+'<td class="l">0</td><td class="gf">0</td><td class="ga">0</td><td class="gd">0</td><td class="pts">0</td></tr>'}};Round.prototype.nextMatch=function(){this.currentMatch++;if(!this.matches[this.currentMatch]){return false}else{return this.matches[this.currentMatch]}};Round.prototype.update=function(event,followMatch){if(event.data){event=event.data}var $hometeam=$("#"+event.homeTeam.dbid);var $awayteam=$("#"+event.awayTeam.dbid);if(event.homeGoals+event.awayGoals===1){this.oldStats={home:$hometeam.clone(),away:$awayteam.clone()}}if(event.homeGoals+event.awayGoals!==0){$hometeam.html(this.oldStats.home.html());$awayteam.html(this.oldStats.away.html())}s("gp");if(event.homeGoals>event.awayGoals){s("pts",$hometeam,3);s("w",$hometeam);s("l",$awayteam)}else if(event.homeGoals<event.awayGoals){s("pts",$awayteam,3);s("w",$awayteam);s("l",$hometeam)}else{s("pts");s("d",$hometeam);s("d",$awayteam)}s("gf",$hometeam,event.homeGoals);s("ga",$hometeam,event.awayGoals);s("gf",$awayteam,event.awayGoals);s("ga",$awayteam,event.homeGoals);var homegd=parseInt($hometeam.find(".gf").html())-parseInt($hometeam.find(".ga").html());var awaygd=parseInt($awayteam.find(".gf").html())-parseInt($awayteam.find(".ga").html());$hometeam.find(".gd").html(homegd);$awayteam.find(".gd").html(awaygd);util.sortTable($("#"+this.structureId).find("table"),config.LEAGUE_SORTORDER);function s(ele,team,val){var teams=team?[team]:[$hometeam,$awayteam];val=typeof val!=="undefined"?val:1;for(var i=0;i<teams.length;i++){var value=parseInt(teams[i].find("."+ele).html());teams[i].find("."+ele).html(value+val)}}};Round.prototype.addScorer=function(player){var $topscorers=$("#topScorers");if(!this.goalscorers[player.dbid]){this.goalscorers[player.dbid]=player;this.goalscorers[player.dbid].totalGoals=1;$topscorers.find("tbody").append('<tr id="'+player.dbid+'"><td>'+player.name+'</td><td class="total">'+this.goalscorers[player.dbid].totalGoals+"</td></tr>")}else{this.goalscorers[player.dbid].totalGoals++;var prow=$("#"+player.dbid);prow.find(".total").html(this.goalscorers[player.dbid].totalGoals)}var playerRow=prow?prow:$("#"+player.dbid);util.sortTable($topscorers.find("table"),[[1,1],[0,0]]);playerRow.addClass("highlight");setTimeout(function(){playerRow.removeClass("highlight")},settings.PLAYER_HIGHLIGHT_DURATION)}},{"../config.js":1,"../settings.js":8,"../util.js":9,"../views/FixtureView.js":10,"../views/LeagueView.js":11,"../views/TableView.js":12,"../views/VideoView.js":13,"../views/View.js":14,"./Match.js":3}],6:[function(require,module,exports){console.time("Init");var settings=require("./settings.js");var ReplayEngine=require("./core/ReplayEngine.js");$(document).on("ready",function(){var replay=new ReplayEngine(settings.DEFAULT_COMP_ID);console.timeEnd("Init")})},{"./core/ReplayEngine.js":4,"./settings.js":8}],7:[function(require,module,exports){module.exports=function(jQuery){jQuery.eventEmitter={_JQInit:function(){this._JQ=jQuery(this)},emit:function(evt,data){!this._JQ&&this._JQInit();this._JQ.trigger(evt,data)},once:function(evt,handler){!this._JQ&&this._JQInit();this._JQ.one(evt,handler)},on:function(evt,handler){!this._JQ&&this._JQInit();this._JQ.bind(evt,handler)},off:function(evt,handler){!this._JQ&&this._JQInit();this._JQ.unbind(evt,handler)}}}(jQuery)},{}],8:[function(require,module,exports){var config=require("./config.js");module.exports={DEFAULT_COMP_ID:0,DEFAULT_STATS:[config.TOPSCORERS],FOLLOW_TEAMS:[],PLAYER_HIGHLIGHT_DURATION:3e3,SCROLL_TO_MATCH_DURATION:2e3,EVENT_DELAY:1500}},{"./config.js":1}],9:[function(require,module,exports){module.exports={formatDate:function(timestamp){var monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"];var date=new Date(timestamp);var day=date.getDate();var monthIndex=date.getMonth();var year=date.getFullYear();var text=day+" "+monthNames[monthIndex]+" "+year;var id=day+monthNames[monthIndex]+year;return{text:text,id:id}},teamClass:function(teamId){return"team"+teamId},matchId:function(matchId){return"match"+matchId},sortTable:function(table,sortOrder){var parent=table.parent();table.remove().appendTo(parent).tablesorter({sortList:sortOrder})},removeVal:function(arr){var what,a=arguments,L=a.length,ax;while(L>1&&arr.length){what=a[--L];while((ax=arr.indexOf(what))!==-1){arr.splice(ax,1)}}return arr},findOne:function(haystack,arr){return arr.some(function(v){return haystack.indexOf(v)>=0})}}},{}],10:[function(require,module,exports){module.exports=FixtureView;var TableView=require("./TableView.js");var config=require("../config.js");function FixtureView(options){options.parent=config.id.FIXTURES;TableView.call(this,options)}FixtureView.prototype=Object.create(TableView.prototype)},{"../config.js":1,"./TableView.js":12}],11:[function(require,module,exports){module.exports=LeagueView;var config=require("../config.js");var TableView=require("./TableView.js");function LeagueView(options){TableView.call(this,options);this.parent=config.id.STRUCTURE;this.addHeader({tr:[{th:"Club"},{th:"GP"},{th:"W"},{th:"D"},{th:"L"},{th:"GF"},{th:"GA"},{th:"GD"},{th:"PTS"}]})}LeagueView.prototype=Object.create(TableView.prototype)},{"../config.js":1,"./TableView.js":12}],12:[function(require,module,exports){module.exports=TableView;function TableView(options){this.id=options.id||"";this.title=options.title;this.parent=options.parent;this.html={};if(this.title){this.html['h1[class="title"]']=this.title}this.html.table={thead:[],tbody:[]};if(options.header){this.addHeader(options.header)}}TableView.prototype.addHeader=function addHeader(trow){this.html.table["thead"].push(trow)};TableView.prototype.render=function(){var absurd=Absurd();var _this=this;var setup={};if(this.id){var sectionTag='section[id="'+this.id+'"]';setup.html={};setup.html[sectionTag]=this.html}else{setup.html=this.html}setup.constructor=function(){this.populate();$("#"+_this.parent).append(this.el)};absurd.component("TableView",setup)()}},{}],13:[function(require,module,exports){},{}],14:[function(require,module,exports){module.exports=View;function View(viewList){this.viewList=viewList}View.prototype.render=function(){for(var i=0;i<this.viewList.length;i++){this.viewList[i].render()}}},{}]},{},[6]);
